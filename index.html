<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8" />
  <title>2025房貸試算</title>
  <style>
    body {
      font-family: "Microsoft JhengHei", sans-serif;
      text-align: center;
    }
    h1 {
      font-size: 32px;
      margin-bottom: 30px;
    }
    .container {
      display: inline-block;
      text-align: left;
    }
    .form-group {
      margin-bottom: 20px;
    }
    .form-group label {
      font-weight: bold;
      display: block;
      margin-bottom: 5px;
    }
  input[type="number"],
input[type="text"],
select {
  width: 400px;
  height: 50px;
  font-size: 18px;
  border-radius: 12px;
  border: 2px solid #ccc;
  padding-left: 10px;
  color: red;
  -moz-appearance: textfield;
}

    /* 移除Chrome上下箭頭 */
    input[type=number]::-webkit-inner-spin-button, 
    input[type=number]::-webkit-outer-spin-button { 
      -webkit-appearance: none;
      margin: 0; 
    }
    #calculate {
      background-color: #007bff;
      color: white;
      border: none;
      width: 400px;
      height: 50px;
      font-size: 18px;
      border-radius: 12px;
      cursor: pointer;
      margin-top: 10px;
    }
    .result {
      font-weight: bold;
      font-size: 18px; /* 縮小約2倍 */
      margin-top: 30px;
      background-color: #fff9db; /* 淡黃色背景 */
      border-radius: 12px;
      padding: 20px;
      color: black;
    }
    .result span {
      color: red;
      font-weight: bold;
      font-size: 18px;
    }
  </style>
</head>
<body>
  <h1>2025房貸試算</h1>
  <div class="container">
    <div class="form-group">
      <label for="amount">貸款金額（萬元）</label>
      <input type="text" id="amount" required placeholder="請輸入金額" />
    </div>
    <div class="form-group">
      <label for="years">貸款年限</label>
      <select id="years" onchange="updateBankOptions()">
        <option value="20">20年</option>
        <option value="30">30年</option>
        <option value="40">40年</option>
      </select>
    </div>
    <div class="form-group">
      <label for="bank">選擇銀行</label>
      <select id="bank" onchange="setInterestRate()"></select>
    </div>
    <div class="form-group">
      <label for="rate">自訂利率（%）</label>
      <input type="text" id="rate" step="0.01" placeholder="可自訂或選銀行" />
    </div>
    <div class="form-group">
      <label for="repaymentType">還款方式</label>
      <select id="repaymentType">
        <option value="equal">本利攤還</option>
        <option value="principal">本金攤還</option>
      </select>
    </div>
    <button id="calculate" onclick="calculateLoan()">試算</button>
    <div class="result" id="monthlyResult"></div>
    <div class="result" id="totalResult"></div>
    <div class="result" id="interestResult"></div>
  </div>

  <script>
    const bankRates = {
      "20": {
        "台灣銀行": 2.09,
        "土地銀行": 2.06,
        "合庫銀行": 2.06,
        "第一銀行": 2.09,
        "華南銀行": 2.1,
        "彰化銀行": 2.05,
        "上海商銀": 2.05,
        "台北富邦": 2.06,
        "兆豐銀行": 2.1,
        "農會": 2.08
      },
      "30": {
        "台灣銀行": 2.12,
        "土地銀行": 2.1,
        "合庫銀行": 2.1,
        "第一銀行": 2.12,
        "華南銀行": 2.13,
        "彰化銀行": 2.08,
        "上海商銀": 2.08,
        "台北富邦": 2.1,
        "兆豐銀行": 2.13,
        "農會": 2.11
      },
      "40": {
        "土地銀行": 2.2,
        "合庫銀行": 2.2,
        "華南銀行": 2.25,
        "兆豐銀行": 2.28,
        "農會": 2.22
      }
    };

    function updateBankOptions() {
      const year = document.getElementById("years").value;
      const bankSelect = document.getElementById("bank");
      bankSelect.innerHTML = "";
      for (const bank in bankRates[year]) {
        const option = document.createElement("option");
        option.value = bank;
        option.text = bank;
        bankSelect.appendChild(option);
      }
      setInterestRate();
    }

    function setInterestRate() {
      const year = document.getElementById("years").value;
      const bank = document.getElementById("bank").value;
      const rate = bankRates[year][bank] || 2.1;
      document.getElementById("rate").value = rate;
    }

    // 將字串數字加千分位，保持只允許數字輸入和格式化
    const amountInput = document.getElementById("amount");
    amountInput.addEventListener("input", function(e){
      let value = e.target.value;
      // 移除非數字
      value = value.replace(/[^\d]/g, "");
      // 加千分位
      const formatted = value.replace(/\B(?=(\d{3})+(?!\d))/g, ",");
      e.target.value = formatted;
    });

    const rateInput = document.getElementById("rate");
    rateInput.addEventListener("input", function(e){
      let value = e.target.value;
      // 允許輸入數字及一個小數點
      value = value.replace(/[^\d.]/g, "");
      const parts = value.split(".");
      if(parts.length > 2){
        value = parts[0] + "." + parts[1];
      }
      e.target.value = value;
    });

    function parseFormattedNumber(str) {
      return parseFloat(str.replace(/,/g, ""));
    }

    function calculateLoan() {
      const amountStr = document.getElementById("amount").value;
      const amount = parseFormattedNumber(amountStr) * 10000;
      const years = parseInt(document.getElementById("years").value);
      const annualRate = parseFloat(document.getElementById("rate").value) / 100;
      if(isNaN(amount) || amount <= 0){
        alert("請輸入有效貸款金額");
        return;
      }
      if(isNaN(annualRate) || annualRate <= 0){
        alert("請輸入有效利率");
        return;
      }
      const months = years * 12;
      const monthlyRate = annualRate / 12;
      const repaymentType = document.getElementById("repaymentType").value;

      let monthlyPayment, totalPayment, totalInterest;

      if (repaymentType === "equal") {
        monthlyPayment = amount * monthlyRate / (1 - Math.pow(1 + monthlyRate, -months));
        totalPayment = monthlyPayment * months;
        totalInterest = totalPayment - amount;
      } else {
        const principalMonthly = amount / months;
        totalInterest = 0;
        for (let i = 0; i < months; i++) {
          totalInterest += (amount - principalMonthly * i) * monthlyRate;
        }
        totalPayment = amount + totalInterest;
        monthlyPayment = principalMonthly + (amount * monthlyRate);
      }

      // 格式化結果加千分位
      function formatCurrency(num) {
        return num.toLocaleString("zh-TW", { minimumFractionDigits: 0 });
      }

      document.getElementById("monthlyResult").innerHTML =
        `每月還款金額：<span>${formatCurrency(Math.round(monthlyPayment))}元</span>`;
      document.getElementById("totalResult").innerHTML =
        `總還款金額：<span>${formatCurrency(Math.round(totalPayment))}元</span>`;
      document.getElementById("interestResult").innerHTML =
        `總利息金額：<span>${formatCurrency(Math.round(totalInterest))}元</span>`;
    }

    // 初始設定
    updateBankOptions();
  </script>
</body>
</html>
